"use strict";

// Contact Form 7 - Clickable Radio Button List Items
document.addEventListener('DOMContentLoaded', function () {
  // Wait for Contact Form 7 to be fully loaded
  var checkFormReady = setInterval(function () {
    var listItems = document.querySelectorAll('.service-selection .wpcf7-list-item');
    if (listItems.length > 0) {
      clearInterval(checkFormReady);
      initClickableRadioItems();
    }
  }, 100);
  function initClickableRadioItems() {
    // Make entire list item clickable for radio buttons
    var listItems = document.querySelectorAll('.service-selection .wpcf7-list-item');
    listItems.forEach(function (item) {
      item.addEventListener('click', function (e) {
        // Only trigger if not clicking directly on the radio button
        if (e.target.type !== 'radio') {
          var radio = item.querySelector('input[type="radio"]');
          if (radio) {
            radio.checked = true;
            // Trigger change event
            radio.dispatchEvent(new Event('change'));
          }
        }
      });
    });
  }
});

// --
// Slider modifications

(function () {
  // Function to modify swiper after initialization
  function modifySwiper(swiperInstance) {
    // Responsive breakpoints (matching _variables.scss)
    swiperInstance.params.breakpoints = {
      0: {
        slidesPerView: 1
      },
      782: {
        // sm (mobile)
        slidesPerView: 2
      },
      1030: {
        // md
        slidesPerView: 2
      },
      1230: {
        // lg (content)
        slidesPerView: 3
      }
    };

    // Apply the changes
    swiperInstance.update();
    console.log('Swiper modified:', swiperInstance);
  }

  // Listen for swiper initialization events
  document.addEventListener('swiper:afterInit', function (event) {
    var swiperInstance = event.detail;
    modifySwiper(swiperInstance);
  });

  // Also handle any existing swipers that might already be initialized
  document.addEventListener('DOMContentLoaded', function () {
    // Small delay to ensure swipers are initialized
    setTimeout(function () {
      var sliders = document.querySelectorAll('.swiper');
      sliders.forEach(function (slider) {
        if (slider.swiper) {
          modifySwiper(slider.swiper);
        }
      });
    }, 100);
  });
})();

// --
// CTA bar visibility based on hero/contact visibility

(function () {
  function isBlockEditorPreview() {
    try {
      if (window.self !== window.top && window.parent && window.parent.document && window.parent.document.body) {
        var parentBody = window.parent.document.body;
        var cls = parentBody.classList;
        return cls.contains('block-editor-page') || cls.contains('edit-site-page');
      }
    } catch (e) {
      // Cross-origin or access issue; assume not editor
    }
    return false;
  }
  function initCtaBarObserver() {
    // Do not run inside Gutenberg/Site Editor preview iframe
    if (isBlockEditorPreview()) return;
    var ctaBar = document.querySelector('.wp-block-group.cta-bar');
    if (!ctaBar) return;
    var hero = document.querySelector('section.hero, .hero');
    var contact = document.querySelector('section.contact, .contact');
    var isHeroCompletelyGone = false;
    var isContactFullyVisible = false;
    function updateCtaVisibility() {
      var shouldShow = isHeroCompletelyGone && !isContactFullyVisible;
      if (shouldShow) {
        ctaBar.classList.add('is-visible');
      } else {
        ctaBar.classList.remove('is-visible');
      }
    }
    if (hero) {
      var heroObserver = new IntersectionObserver(function (entries) {
        entries.forEach(function (entry) {
          // Show CTA only when hero is completely out of viewport
          isHeroCompletelyGone = !entry.isIntersecting;
          updateCtaVisibility();
        });
      }, {
        root: null,
        threshold: 0
      });
      heroObserver.observe(hero);
    } else {
      // If there is no hero section, keep CTA hidden by default
      isHeroCompletelyGone = false;
      updateCtaVisibility();
    }
    if (contact) {
      var contactObserver = new IntersectionObserver(function (entries) {
        entries.forEach(function (entry) {
          // Hide CTA when contact section is fully visible in viewport
          isContactFullyVisible = entry.isIntersecting && entry.intersectionRatio >= 0.1;
          updateCtaVisibility();
        });
      }, {
        root: null,
        threshold: 0.1
      });
      contactObserver.observe(contact);
    }
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCtaBarObserver);
  } else {
    initCtaBarObserver();
  }
})();

// --
// Newsticker functionality

(function () {
  // Newsticker configuration
  var config = {
    selector: '.wp-block-group.newsticker',
    contentSelector: '.newsticker-content',
    speed: 50,
    // pixels per second
    pauseOnHover: true,
    resetThreshold: 0.1,
    // Reset when 10% past the left edge
    mobileBreakpoint: 782,
    // Same as $breakpoints.sm from SCSS
    debug: false
  };

  // Check if current viewport is mobile
  function isMobile() {
    return window.innerWidth <= config.mobileBreakpoint;
  }
  function createNewsticker(container) {
    var content = container.querySelector(config.contentSelector);
    if (!content) {
      if (config.debug) console.warn('Newsticker content not found in container:', container);
      return null;
    }

    // Create newsticker instance
    var newsticker = {
      container: container,
      content: content,
      containerWidth: 0,
      contentWidth: 0,
      position: 0,
      isPaused: false,
      animationId: null,
      lastTime: 0,
      isActive: false,
      init: function init() {
        if (isMobile()) {
          this.setupDOM();
          this.calculateDimensions();
          this.setupEventListeners();
          this.start();
          this.isActive = true;
        } else {
          this.deactivate();
        }
        if (config.debug) console.log('Newsticker initialized:', this, 'Active:', this.isActive);
      },
      activate: function activate() {
        if (!this.isActive && isMobile()) {
          this.setupDOM();
          this.calculateDimensions();
          this.start();
          this.isActive = true;
          if (config.debug) console.log('Newsticker activated');
        }
      },
      deactivate: function deactivate() {
        if (this.isActive) {
          this.stop();
          this.resetDOM();
          this.isActive = false;
          if (config.debug) console.log('Newsticker deactivated');
        }
      },
      resetDOM: function resetDOM() {
        // Reset inline styles for desktop display
        this.content.style.transform = '';
        this.content.style.willChange = '';
        // Remove duplicated content for desktop
        this.removeDuplicateContent();
      },
      setupDOM: function setupDOM() {
        // Ensure proper CSS setup
        this.container.style.overflow = 'hidden';
        this.container.style.position = 'relative';
        this.container.style.width = '100%';
        this.content.style.display = 'flex';
        this.content.style.whiteSpace = 'nowrap';
        this.content.style.willChange = 'transform';
        this.content.style.position = 'relative';

        // Duplicate content for seamless loop
        this.duplicateContent();
      },
      duplicateContent: function duplicateContent() {
        var _this = this;
        // Check if content is already duplicated
        if (this.content.querySelector('.newsticker-duplicate')) {
          return;
        }

        // Clone all children and append them
        var originalChildren = Array.from(this.content.children);
        originalChildren.forEach(function (child) {
          var clone = child.cloneNode(true);
          clone.classList.add('newsticker-duplicate');
          _this.content.appendChild(clone);
        });
        if (config.debug) console.log('Content duplicated for seamless loop');
      },
      removeDuplicateContent: function removeDuplicateContent() {
        // Remove duplicated content
        var duplicates = this.content.querySelectorAll('.newsticker-duplicate');
        duplicates.forEach(function (duplicate) {
          return duplicate.remove();
        });
        if (config.debug) console.log('Duplicate content removed');
      },
      calculateDimensions: function calculateDimensions() {
        this.containerWidth = this.container.offsetWidth;
        // Calculate original content width (half of total, since we duplicated)
        this.originalContentWidth = this.content.scrollWidth / 2;
        this.contentWidth = this.content.scrollWidth;
        this.position = 0; // Start from original position

        if (config.debug) {
          console.log('Dimensions calculated:', {
            container: this.containerWidth,
            originalContent: this.originalContentWidth,
            totalContent: this.contentWidth
          });
        }
      },
      setupEventListeners: function setupEventListeners() {
        var _this2 = this;
        if (config.pauseOnHover) {
          this.container.addEventListener('mouseenter', function () {
            if (_this2.isActive) _this2.pause();
          });
          this.container.addEventListener('mouseleave', function () {
            if (_this2.isActive) _this2.resume();
          });
        }

        // Handle visibility change (pause when tab is not visible)
        document.addEventListener('visibilitychange', function () {
          if (_this2.isActive) {
            if (document.hidden) {
              _this2.pause();
            } else if (!_this2.container.matches(':hover')) {
              _this2.resume();
            }
          }
        });
      },
      animate: function animate(currentTime) {
        var _this3 = this;
        if (!this.lastTime) this.lastTime = currentTime;
        var deltaTime = currentTime - this.lastTime;
        this.lastTime = currentTime;
        if (!this.isPaused && deltaTime > 0) {
          // Calculate movement based on time elapsed
          var movement = config.speed * deltaTime / 1000;
          this.position -= movement;

          // Reset when original content width is scrolled (seamless loop with duplicates)
          if (this.position <= -this.originalContentWidth) {
            this.position = 0; // Reset to create seamless loop
          }

          // Apply transform
          this.content.style.transform = "translateX(".concat(this.position, "px)");
        }
        this.animationId = requestAnimationFrame(function (time) {
          return _this3.animate(time);
        });
      },
      start: function start() {
        var _this4 = this;
        if (this.animationId) {
          cancelAnimationFrame(this.animationId);
        }
        this.lastTime = 0;
        this.animationId = requestAnimationFrame(function (time) {
          return _this4.animate(time);
        });
      },
      pause: function pause() {
        this.isPaused = true;
        if (config.debug) console.log('Newsticker paused');
      },
      resume: function resume() {
        this.isPaused = false;
        if (config.debug) console.log('Newsticker resumed');
      },
      stop: function stop() {
        if (this.animationId) {
          cancelAnimationFrame(this.animationId);
          this.animationId = null;
        }
      },
      handleResize: function handleResize() {
        // Check if mobile state changed and activate/deactivate accordingly
        if (isMobile() && !this.isActive) {
          this.activate();
        } else if (!isMobile() && this.isActive) {
          this.deactivate();
        } else if (this.isActive) {
          // Just recalculate dimensions if still active
          this.calculateDimensions();
        }
        if (config.debug) console.log('Newsticker resized, mobile:', isMobile(), 'active:', this.isActive);
      },
      // Public method to update speed
      setSpeed: function setSpeed(newSpeed) {
        config.speed = newSpeed;
        if (config.debug) console.log('Newsticker speed updated to:', newSpeed);
      }
    };
    return newsticker;
  }
  function initNewstickers() {
    var containers = document.querySelectorAll(config.selector);
    var instances = [];
    containers.forEach(function (container) {
      // Skip if already initialized
      if (container.newstickerInstance) {
        return;
      }
      var instance = createNewsticker(container);
      if (instance) {
        instance.init();
        container.newstickerInstance = instance;
        instances.push(instance);
      }
    });

    // Setup global resize handler for all instances
    if (instances.length > 0) {
      var resizeTimeout;
      window.addEventListener('resize', function () {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(function () {
          instances.forEach(function (instance) {
            if (instance && instance.handleResize) {
              instance.handleResize();
            }
          });
        }, 250);
      });
    }
    return instances;
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initNewstickers);
  } else {
    initNewstickers();
  }

  // Expose global functions for manual control (optional)
  window.NewstickerControl = {
    init: initNewstickers,
    pauseAll: function pauseAll() {
      document.querySelectorAll(config.selector).forEach(function (container) {
        if (container.newstickerInstance && container.newstickerInstance.isActive) {
          container.newstickerInstance.pause();
        }
      });
    },
    resumeAll: function resumeAll() {
      document.querySelectorAll(config.selector).forEach(function (container) {
        if (container.newstickerInstance && container.newstickerInstance.isActive) {
          container.newstickerInstance.resume();
        }
      });
    },
    setGlobalSpeed: function setGlobalSpeed(speed) {
      config.speed = speed;
      document.querySelectorAll(config.selector).forEach(function (container) {
        if (container.newstickerInstance && container.newstickerInstance.isActive) {
          container.newstickerInstance.setSpeed(speed);
        }
      });
    },
    forceActivateAll: function forceActivateAll() {
      document.querySelectorAll(config.selector).forEach(function (container) {
        if (container.newstickerInstance) {
          container.newstickerInstance.activate();
        }
      });
    },
    deactivateAll: function deactivateAll() {
      document.querySelectorAll(config.selector).forEach(function (container) {
        if (container.newstickerInstance) {
          container.newstickerInstance.deactivate();
        }
      });
    },
    isMobile: isMobile
  };
})();
//# sourceMappingURL=app.min.js.map