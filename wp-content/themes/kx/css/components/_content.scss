section {
    padding-block: fluid(rem(50px), rem(65px));
    overflow-x: clip;

    > .wp-block-columns {
        margin-block: fluid(rem(20px), rem(65px));
    }
}

// --- Blog enhancements styles ---
html:not(.landing-page)
body:not(.home) {
    #masthead {
        background: transparent;
    }

    #primary {
        padding-block-start: rem(50px);
    }
}

[rel="tag"] {
    display: inline-block;
	background-color: $dark-blue;
	color: $white;
	padding: 0.5rem;
    margin-block: 0.5rem;
	border-radius: 0.5rem;
	font-size: rem(14px);
	text-decoration: none !important;

	&:hover {
		background-color: $dark-blue-hover !important;
        color: $white;
	}
}

.post-meta-box {
	margin-block: rem(20px);

    > .wp-block-group {
        > .wp-block-group {
            padding: .5rem;
        }
    }
}

.post-toc-box {
	margin-block: rem(20px);

    > .wp-block-group {
        padding: rem(20px);
        border-radius: rem(10px);
        background-color: $off-white;

        h2 {
            margin-block: rem(20px);
        }
    }
}

.wp-block-post-author {
    margin-block: rem(50px);

    img {
        border-radius: 100%;
    }
}

.alignfull {
    overflow-x: clip;
}

.hero {
    padding-bottom: 35px;
    margin-block-end: 2rem;
    overflow-y: clip;

    > .wp-block-columns {
        margin-bottom: 0;
        position: relative;
        perspective: 1500px;  // Enable 3D space for children
        perspective-origin: center center;

        > .wp-block-image {
            img {
                margin-inline: auto;
                max-width: 70%;
                @include media-breakpoint-up(sm) {
                    position: absolute;
                    bottom: 0;
                    right: 0;
                    width: fluid(rem(390px), rem(450px));
                    height: auto;
                }
            }
        }
    }

    > .wp-block-group {
        padding-block: fluid(rem(10px), rem(40px));

        figure {
            padding: 0;
        }
    }

    .wp-block-image {
        display: flex;

        img {
            margin-left: auto;
        }
    }

    > .wp-block-buttons {
        flex-wrap: nowrap;
        .wp-block-button {
            flex-basis: 50%;
            .wp-block-button__link {
                padding-block: 0;
                min-height: 90px;
            }
        }

        @include media-breakpoint-down(376px) {
            flex-direction: column;
            & .wp-block-button {
                width: 100%;
                flex-basis: 100%;
            }
        }
    }

    // Mobile: Optimize spacing and alignment
    @include media-breakpoint-down(sm) {
        padding-block: rem(15px) rem(20px);
        margin-block-end: 1rem;

        h1, h2, h3, h4, h5, h6 {
            text-align: center;
        }

        p {
            text-align: center;
            margin-bottom: rem(16px);
        }

        .wp-block-buttons {
            justify-content: center;
            margin-top: rem(10px);
        }
    }

    // Works Ticker styles - 3D with infinite loop scroll animation
    .works-ticker {
        position: absolute;
        z-index: -1;
        opacity: 0.3;
        bottom: 0;
        right: -170px;
        transform-style: preserve-3d;
        
        // 3D positioning (static, no animation here)
        transform: perspective(500px) rotateX(12deg) rotateY(356deg);
        transform-origin: bottom right;
        overflow: hidden;
        height: 100vh;
        width: 600px; // Set a fixed width for the ticker
        
        // Inner wrapper for animation
        &-inner {
            // Force vertical stacking (override Gutenberg styles)
            display: flex !important;
            flex-direction: column !important;
            flex-wrap: nowrap !important;
            gap: rem(20px) !important;
            align-items: flex-start !important;
            
            // Animation: Infinite scroll from bottom to top
            // Content is duplicated via JavaScript, so we move -50% for seamless loop
            animation: tickerScrollUpInfinite 30s linear infinite;
            will-change: transform;
        }
        
        // Target all child elements (figures, divs, etc.)
        > *,
        &-inner > * {
            width: 100%;
            flex-shrink: 0;
            margin: 0;
        }
        
        figure,
        .wp-block-image {
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid $grey;
            flex-shrink: 0;
            display: block;
            width: 100%;
        }

        &:before {
            z-index: 1;
            position: absolute;
            content: '';
            display: block;
            height: 80px;
            width: 100%;
            background: linear-gradient(to top, rgba(255, 255, 255, 0), $light-blue);
        }
    }

    // Keyframes for infinite vertical ticker animation
    // Moves 50% because content is duplicated (original + clone = 200%)
    @keyframes tickerScrollUpInfinite {
        0% {
            transform: translateY(0);
        }
        100% {
            transform: translateY(-50%);
        }
    }
}

.facts {

    padding-block-end: 0;

    @include media-breakpoint-down(lg) {
        background: transparent !important;

        > .wp-block-group {
            flex-direction: column;
    
            > figure {
                background-color: $light-blue;
                display: block;
                border-radius: 100%;
                aspect-ratio: 1 / 1;
                overflow: hidden;
    
                + .wp-block-group {                    
                    h2, p {
                        text-align: center;
                    }

                    .wp-block-columns {
                        justify-content: center;
                        row-gap: rem(15px);

                        .wp-block-column {

                            &[style*="flex-basis:33%"] {    
                                flex-basis: 33.33% !important;
                                max-width: 33.33% !important;
                            }

                            &[style*="flex-basis:100%"] {
                                justify-items: center;
                            }
                            
                        }
                    }
                }
            }
    
            > .wp-block-group > .wp-block-group { // Title with icon
                display: block;
                justify-content: center;
                margin-block-end: 4rem;
                margin-inline: auto;
            }
        }
    }

    @include media-breakpoint-up(lg) {
        > .wp-block-group {
            align-items: stretch;

            > figure {
                margin-right: rem(60px);
            }
    
            > .wp-block-group {
                display: flex;
                flex-direction: column;
    
                > * {
                    width: 100%;
                }
    
                .wp-block-columns {
                    justify-content: center;
                    height: 60%;
                    margin-top: auto;
                    margin-bottom: 0;
                }
            }
    
        }   
    }
}

// --- Blog excerpt styles ---
.kx-posts-grid, .archive {

    .kx-posts-grid__filters {
        display: flex;
        gap: rem(8px);
        flex-wrap: wrap;
        margin-block: rem(20px);

        // reuse tag style
        .kx-tag[rel="tag"] {
            // base tag style comes from [rel="tag"] above
            &.is-active {
                outline: 2px solid $dark-blue-hover;
            }
        }
    }

    .kx-posts-grid__items, .blog-posts-section {

        margin-block: rem(50px);
    
        > article {
            margin-block-end: rem(50px);
    
    
            .tags-links {
                display: flex;
                gap: rem(5px);
                flex-wrap: wrap;
                padding-block: rem(10px);
    
                a {
                    margin: 0;
                }
            }
    
            .kx-post-card__thumb {
                display: block;
                height: rem(200px);
                img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    border-radius: rem(10px);
                }
            }
    
            .kx-post-card__title {
                margin-block: rem(10px);
                a {
                    font-size: rem(20px);
                }
            }
    
            .kx-post-card__byline {
                font-size: rem(14px);
            }
        }
    
        @include media-breakpoint-up(lg) {  
            display: flex;
            flex-wrap: wrap;
            gap: rem(50px);
    
            > article {
                flex-basis: calc(33.33% - rem(50px));
                max-width: calc(33.33% - rem(50px));
            }
        }
        
    }

    .kx-posts-grid__actions {
        display: flex;
        justify-content: center;
        margin-block-end: rem(50px);
    }
}

// --- Pagination styles ---
.nav-links {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: fluid(rem(20px), rem(200px));
    margin-block: rem(50px);
}